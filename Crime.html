<!DOCTYPE HTML>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Crime Inspector</title>

	<!--Stylesheet import for API page-->
	<link rel="stylesheet" href="css/apipage.css">

	<!--Stylesheet import for footer-->
	<link rel="stylesheet" href="css/footer.css">

	<!--Stylesheet import for navbar-->
	<link rel="stylesheet" href="css/navbar.css">

	<!--Bootstrap framework import-->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
		integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
	</script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
	</script>


	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
	<!--<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">-->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.css"
		rel="stylesheet">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>


	<div id="page">
		<div class="intro container">
			<section class="page-title">
				<h1>Crime Inspector</h1>
			</section>

			<aside class="text desc text-justify">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
					ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris
					nisi ut
					aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu
					fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
					deserunt mollit
					anim id est laborum.</p>

			</aside>
			<aside class="text tut text-justify">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
					ut labore et dolore magna aliqua.</p>

				<a href="tutlifeexpectancy.html">
					<button type="button" class="btn btn-sm btn-outline-dark">Link to Tutorial Page</button>
				</a>
			</aside>
		</div>



		<div class="api-content container">
			<div id="options">
				<div class="row">
					<div class="col-sm-12 col-md-6">
						<input class="form-control input-sm" id="LocationText" placeholder="Location" type="text">
					</div>
				</div>

				<!-- 				<label for="date" style="margin-top: 1em">Date(Optional)</label>
				<input id="date" class="date-own form-control" type="text"> -->
				<div class="bootstrap-iso">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-6 col-sm-6 col-xs-12">

								<!-- Form code begins -->
								<div class="form-group">
									<!-- Date input -->
									<label class="control-label" for="date">Date</label>
									<input autocomplete="off"  class="date-own form-control" id="date" name="date" placeholder="YYYY-MM"
										type="text" />
								</div>
								<!-- Form code ends -->

							</div>
						</div>
					</div>
				</div>
				<button type="button" class="" name="Info" id="ChartDisplay" value="DisplayChart"
					style="margin-top: 1em">Display Chart</button>
				<div id="chart-container">
					<canvas id="myChart"></canvas>
				</div>
			</div>

		</div>
	</div>

	<script>
		//var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
		var options = {
			container: ".form-group",
			autoclose: true,
			minViewMode: 1,
			format: 'yyyy-mm',
			startDate: '2016-04',
			endDate: "0d",
			orientation: "auto",
			clearBtn: true
			//pickerPosition: "bottom-left"
		};
		$('.date-own').datepicker(options);
		$(document).ready(function () {
			$("#ChartDisplay").click(function () {
				var myChart;
				var antiSocialBehaviourCount = 0;
				var bicycleTheftCount = 0;
				var burglaryCount = 0;
				var criminalDamageArsonCount = 0;
				var drugsCount = 0;
				var otherTheftCount = 0;
				var possessionOfWeaponsCount = 0;
				var publicOrderCount = 0;
				var robberyCount = 0;
				var shopliftingCount = 0;
				var theftFromThePersonCount = 0;
				var vehicleCrimeCount = 0;
				var violentCrimeCount = 0;
				var otherCrimeCount = 0;
				$("#chart-container").html("");
				$("#myChart").remove(); // removing previous canvas element
				$("#chart-container").append('<canvas id="myChart" class="myChart"></canvas>');
				//width="500" height="500"
				var location = document.getElementById('LocationText').value;
				var longitude; //= document.getElementById('Longitude').value;
				var latitude; //= document.getElementById('Latitude').value;
				var date = $('#date').val(); //+ "-01";

				$.ajax({
					type: "GET",
					url: "http://api.apixu.com/v1/current.json?key=75fb86a2371f4abca12115412190403&q=" +
						location,
					dataType: "json",
					error: function () {
						alert("Issue obtaining API data. Please enter a proper location.");
					},
					success: function (data) {
						latitude = data.location.lat;
						longitude = data.location.lon;
						if (!(data.location.country == "United Kingdom")) {
							alert("Location not in United Kingdom");
						} else {
							$.ajax({
								type: "GET",
								url: "https://data.police.uk/api/crimes-street/all-crime?lat=" +
									latitude +
									"&lng=" +
									longitude + "&date=" + date,
								dataType: "json",
								success: function (data) {
									console.log(data)

									var arrayLength = data.length;
									console.log(arrayLength);

									//console.log(arrayLength);

									for (var i = 0; i < arrayLength; i++) {
										if (data[i].category ==
											"anti-social-behaviour") {
											antiSocialBehaviourCount++;
										}
										if (data[i].category == "bicycle-theft") {
											bicycleTheftCount++;

										}
										if (data[i].category == "burglary") {
											burglaryCount++;

										}
										if (data[i].category ==
											"criminal-damage-arson") {
											criminalDamageArsonCount++;

										}
										if (data[i].category == "drugs") {
											drugsCount++;

										}
										if (data[i].category == "other-theft") {
											otherTheftCount++;

										}
										if (data[i].category ==
											"possession-of-weapons") {
											possessionOfWeaponsCount++;

										}
										if (data[i].category == "public-order") {
											publicOrderCount++;

										}
										if (data[i].category == "robbery") {
											robberyCount++;

										}
										if (data[i].category == "shoplifting") {
											shopliftingCount++;

										}
										if (data[i].category ==
											"theft-from-the-person") {
											theftFromThePersonCount++;

										}
										if (data[i].category == "vehicle-crime") {
											vehicleCrimeCount++;

										}
										if (data[i].category == "violent-crime") {
											violentCrimeCount++;

										}
										if (data[i].category == "other-crime") {
											otherCrimeCount++;

										}
									}
									//console.log(otherCrimeCount);





								},
								/* 							error: function (jqXHR, status, errorThrown) {
																alert("Location not in United Kingdom");
															}, */
								complete: function (data) {
									var ctx = document.getElementById('myChart');
									myChart = new Chart(ctx, {
										type: 'horizontalBar',
										data: {
											labels: ["Anti-social behaviour",
												"Bicycle theft",
												"Burglary",
												"Criminal damage and arson",
												"Drugs",
												"Other theft",
												"Possession of weapons",
												"Public order", "Robbery",
												"Shoplifting",
												"Theft from the person",
												"Vehicle crime",
												"Violence and sexual offences",
												"Other crime"
											],
											datasets: [{
												label: 'Amount:',
												data: [antiSocialBehaviourCount,
													bicycleTheftCount,
													burglaryCount,
													criminalDamageArsonCount,
													drugsCount,
													otherTheftCount,
													possessionOfWeaponsCount,
													publicOrderCount,
													robberyCount,
													shopliftingCount,
													theftFromThePersonCount,
													vehicleCrimeCount,
													violentCrimeCount,
													otherCrimeCount
												],
												backgroundColor: [
													"#33ccff",
													"#0099cc",
													"#006080",
													"#00394d",
													" #4d0026",
													"#800040",
													"#b30059",
													" #e60073",
													"#ff1a8c",
													"#ff99cc"
												],
												//backgroundColor: ["#69D2E7", "#A7DBD8", "#94b2a2", "#a3a88b", "#b29e74" , , ,"#F38630", "#FA6900"],

											}]
										},
										options: {
											responsive: true,
											maintainAspectRatio: true,
											legend: {
												display: false,
											}
										}
									});
								}
							});
						}
					},
					complete: function (data) {}
				});
			});

		});
	</script>
	<!--Link to local Javascript file-->
	<script type="text/javascript" src="js/lifeExpectancy.js"></script>


	<div id="navbar">
		<!--Import Navbar file onto page-->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/navbar.js"></script>
	</div>

	<!-- <div id="footer">
		Import Footer file onto page
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/footer.js"></script>
	</div> -->

</body>

</html>