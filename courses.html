<!DOCTYPE HTML>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qualification Calculator</title>

	<!--Stylesheet import for API pages-->
	<link rel="stylesheet" href="css/apipage.css">

	<!--Stylesheet import for footer-->
	<link rel="stylesheet" href="css/footer.css">

	<!--Stylesheet import for navbar-->
	<link rel="stylesheet" href="css/navbar.css">

	<!--Bootstrap framework import-->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	 crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
	 crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
	 crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	 crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>

	<div id="page">
		<div class="intro container">
			<section class="page-title">
				<h1>Path Finder</h1>
			</section>

			<aside class="text desc text-justify">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
					ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
					aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
					fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
					anim id est laborum.</p>

			</aside>
			<aside class="text tut text-justify">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
					ut labore et dolore magna aliqua.</p>

				<a href="tutcourses.html">
					<button type="button" class="btn btn-sm btn-outline-dark">Link to Tutorial Page</button>
				</a>
			</aside>
		</div>

		<div class="api-content container" style="position: relative; height:40; width:80">
			<Select id="CourseDropdown" name="CourseDropdown">
			</Select>
			<div id="chart-container">
				<canvas id="myChart"></canvas>
			</div>
		</div>
	</div>

	<script>
		$(document).ready(function () {
			$("#myChart").remove(); // removing previous canvas element
			$("#chart-container").append('<canvas id="myChart" class="myChart"></canvas>');
			$.ajax({
				type: "GET",
				url: "http://api.lmiforall.org.uk/api/v1/hesa/list-courses",
				dataType: "json",
				success: function (data) {
					console.log(data)

					var CourseID = [];
					var CourseName = [];

					var arrayLength = data.length;
					//console.log(arrayLength);

					for (var i = 0; i < arrayLength; i++) {
						CourseID[i] = data[i].id;
						CourseName[i] = data[i].name;
					}

					console.log(CourseID);
					console.log(CourseName);

					for (var i = 1; i < arrayLength; i++) {
						$('#CourseDropdown').append('<option value="' + CourseID[i] + '">' + CourseName[i] + '</option>');
					}
				}
			});

			$("#CourseDropdown").change(function () {
				$("#myChart").remove(); // removing previous canvas element
				$("#chart-container").append('<canvas id="myChart" class="myChart"></canvas>');
				var course = document.getElementById('CourseDropdown').value;
				$.ajax({
					type: "GET",
					url: "http://api.lmiforall.org.uk/api/v1/hesa/occupations?courses=" + course,
					dataType: "json",
					success: function (data) {
						console.log(data)

						var OccupationSOC = [];
						var OccupationTitle = [];
						var OccupationPercentage = [];


						var arrayLength = data.length;
						//console.log(arrayLength);

						for (var i = 0; i < arrayLength; i++) {
							//OccupationSOC[i] = data[arrayLength - 1][i].soc;
							OccupationTitle[i] = data[3].occupations[i].title;
							OccupationPercentage[i] = data[3].occupations[i].percentage;
						}

						//var total = 0;
						//for (var i = 0; i < OccupationPercentage.length; i++) {
						//	total += OccupationPercentage[i] << 0;
						//}
						
						//OccupationTitle[arrayLength] = "Other";
						//OccupationPercentage[arrayLength] = 100-total;

						console.log(OccupationTitle)

						var ctx = document.getElementById('myChart');
						var myChart = new Chart(ctx, {
							type: 'doughnut',
							data: {
								labels: OccupationTitle,
								datasets: [{
									label: '#percentage of workers',
									data: OccupationPercentage,
									backgroundColor: ["#FF0000", "#0000FF", "#FFFF00", "#00FF00", "#FF00FF", "#FFA500"],
								}]
							},
							options: {
								responsive: true,
							}
						});


					}
				});
			});

			$("#Submit").click(function () {
				var ctx = document.getElementById('myChart');
				var myChart = new Chart(ctx, {
					type: 'pie',
					data: {
						labels: ['Red', 'Blue', 'Yellow', 'Lime', 'Magenta', 'Orange'],
						datasets: [{
							label: '# of Votes',
							data: [12, 19, 3, 5, 2, 3],
							backgroundColor: ["#FF0000", "#0000FF", "#FFFF00", "#00FF00", "#FF00FF", "#FFA500"],
						}]
					},
					options: {
						responsive: true,
					}
				});
			});
		});
	</script>

	<div id="navbar">
		<!--Import Navbar file onto page-->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/navbar.js"></script>
	</div>


	<div id="footer">
		<!--Import Footer file onto page-->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/footer.js"></script>
	</div>
</body>

</html>